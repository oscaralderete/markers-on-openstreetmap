/*
@author:Oscar Alderete <wordpress@oscaralderete.com>
@website: https://oscaralderete.com
@editor: NetBeans IDE v11.2
*/
const MarkersOnOpenStreetMap=Vue.createApp({data(){return{key:openstreetmapData.key,markers:openstreetmapData.markers,marker:this.getBlankMarker(),map_height:openstreetmapData.map_height,edited_marker:this.getBlankMarker(),edited_index:null,initial_zoom:openstreetmapData.initial_zoom}},components:{"oa-toast":OA_Toast,"oa-dialogs":OA_Dialogs},methods:{getBlankMarker(){return{title:"",content:"",latitude:null,longitude:null}},updateZoomLevel(){const self=this;if(""==this.initial_zoom)return this.$refs.dialogs.show({title:"ERROR",message:"You must enter a valid map zoom"}),!1;this.loader(1),this.fetch({type:"save_initial_zoom",data:{initial_zoom:self.initial_zoom}},function(response){self.loader(0),self.initial_zoom=response.initial_zoom,self.$refs.toast.text({message:response.msg,type:"success"})})},updateMapHeight(){const self=this;if(this.map_height<=0)return this.$refs.dialogs.show({title:"ERROR",message:"You must enter a valid height"}),!1;this.loader(1),this.fetch({type:"save_map_height",data:{map_height:self.map_height}},function(response){self.loader(0),self.$refs.toast.text({message:response.msg,type:"success"})})},saveMarker(){event.preventDefault();const self=this;this.markers.push(this.marker),this.loader(1),this.fetch({type:"save_marker",data:{markers:self.markers,action:"save"}},function(response){self.loader(0),self.marker=self.getBlankMarker(),self.toggleModal("formAdd"),self.$refs.toast.text({message:response.msg,type:"success"})})},toggleEditModal(index,obj){this.edited_marker.title=obj.title,this.edited_marker.content=obj.content,this.edited_marker.latitude=obj.latitude,this.edited_marker.longitude=obj.longitude,this.edited_index=index,this.toggleModal("formEdit")},toggleModal(str){const f=document.getElementById(str);f.classList.toggle("active")},deleteMarker(i,obj){const self=this;this.$refs.dialogs.show({title:"WARNING",message:"Are you sure you want to delete this marker: "+obj.title+"?",buttons:{ok:{callback:function(){self.loader(1),self.markers.splice(i,1),self.fetch({type:"save_marker",data:{markers:self.markers,action:"delete"}},function(response){self.loader(0),self.$refs.toast.text({message:response.msg,type:"success"})})}},cancel:{label:"CANCEL"}}})},updateMarker(){event.preventDefault();const self=this;this.markers[this.edited_index]=this.edited_marker,this.loader(1),this.fetch({type:"save_marker",data:{markers:self.markers,action:"save"}},function(response){self.loader(0),self.marker=self.getBlankMarker(),self.toggleModal("formEdit"),self.$refs.toast.text({message:response.msg,type:"success"})})},cancelModal(str){event.preventDefault(),this.toggleModal(str)},fetch(obj,callback){var self=this;jQuery.ajax({url:ajaxurl,type:"POST",data:{action:openstreetmapData.ajax_action,type:obj.type,data:obj.data},success:function(x){x=JSON.parse(x);"function"==typeof callback&&"OK"===x.result?callback(x):(self.loader(0),self.$refs.dialogs.show({title:"ERROR",message:x.msg}))},error:function(error){self.loader(0),self.$refs.dialogs.show({title:"ERROR",message:"Request error code: "+error.status})}})},loader(num){const x=document.getElementById("loader").classList;var y="active";1===num?x.add(y):x.remove(y)}}}).mount("#markersonopenstreetmap");